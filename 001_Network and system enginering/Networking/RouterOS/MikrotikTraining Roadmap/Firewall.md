---
Category: Information
tags:
  - information
  - open
---
---
###### External links
- 
---
## Description


---
## Firewall
### Filter
По базе правило в фаерволе состоит из условия и действия, где условия:
- general *
- advanced **
- extra ***
и действия:
- action

- *Понятное дело шо все срабатывает по-порядку. НО, ЦЕПОЧКИ РАБОТАЮТ ОТДЕЛЬНО, то есть **инпут трафик, например, не будет проверяться - а форвард ли я трафик?**, это все просто напросто в отдельных местах проходится по фильтру.*
- *Если пакет попал под правило и действие связанно с каким-то конкретным действием, дальше по цепочке пакет не обрабатывается.*
- *по бузе нужно помнить, что сначала в прероутинге срабатывает дст-нат а потом роутинг десижн, то есть понимает на какой интерфейс или куда попадет пакет, и после этого мы уже опираемся на тип цепочки.*
- 

#### Actions:
- reject - как дроп, только в ответ отправляет еще icmp сообщение выбранное (удобно, вот к примеру если на сайт стучаться, то он просто будет в трубу, а так, можно сделать что бы сразц ответ гамна какой-то приходил).
- пассру - тупо счетчик
- log - лог
- return - возврат из цепочки
- tarpit - в тсп на СИН отвечает СИН+АКК с нулевым окном. (*Он конечно прикольный, но использовать его редко, и в наружу как бы тоже не желательно. По сути может типо имитировать работу службы. Вот в примере было, что бот хочет пофлудить а мы его в тарпит и он на нём будет висеть, вместо того что мы его дропнем, он поменяет айпишник и будет с другого.*)
- jump - перекидует трафик на созданную цепочку, он проходит по ней и потом возвращается на изначальную (*и получается какие то правила могут иметь кастомную цепочку, и остальные не будут там проверятся, в тупую оптимизация*)
- return - применяется к цепочке кастомной - возврат из цепочки (не знаю шото он не то говорит, но как я понимаю это не просто выйти, а для определённого пакета выйти удобно будет, а так он все равно возвращается в конце из цепочки до момента после джампа).
- 

*Интересная штука, что reject - это работа для роутера, и просто видя что роутер отвечает режектами, можно его в тупую зафлудить. Короче как минимум желательно его не юзать в наружу.*

*Для айсиэмпи хорошей практикой есть сделать для него отдельную цепочку и делать разные ответы в **ICMP options***

---
### NAT
- Если в экшене дст-нат указывать порт то по идее прям немного может никак влияет на производительность
- Если на интерфейсе есть статический адрес то лучше явно указывать срц-нат а не маскарад, а то железке надо куда-то сходить шото посотреть, там найти и уже тогда этот адрес использовать
- **accept**, по идее в экшене как раз в выбраной цепочке остановит дальшейшее прохождение по правилам*
- **netmap** - как дст только тут суть поменять подсети, в примере просто в to adresses указывается другая подсеть и по сути меняется только кусок отличия сетей (*как пример когда две подсети имеют одинаковые параметры сети но им надо пообщаться, но это костыль*)
- **dst-nat** быстрее конкретно для форвардинга портов (*в нетмапе сравниваются адреса и меняется кусок а в дстнате сразу берется адресс и меняется*)
- **same** - прмерно как маскарад, но указывается пул айпишников, из которых нат сам берет и себе подставляет (*вроде как провайдеры юзают*), но только не пойму, будут айпишники браться которые на интерфейсе или конкретно с пула

---
### Connection state
- **new** - понятно, пакет открывает соединение
- **established** - принадлежит уже к открытому соединению, если что-то не похожее на тсп, например, юдп, то роутерОС использует свои таймауты (*если параметры соединения те же самые и попал в таймаут то роутерОС просто продлевает таймаут и соединение остаётся таким*)
- **related** - пакет открывает новое соединение на основе существующего, потому что может, например, открыться на другом порте (*обычно сервисы с такими штуками впилены в линукс системы и как-то там это деело понимает*)
- **invalid** - не принадлежит соединению, последовательность нарушена (к примеру прилетел ак, а сина не было), но при этом его пропустила до этого проверка checksum
- **untracked** - в таблице raw, для обхода конекшн треккинга (**connection state**) (ну к примеру опять же для оптимизации трафика форвард между локалками)

---
### Пример деф. фаервола
- ну понятно все деф флаги на форвард и инпут пропустить
- ну инвалид чисто с инпут интерфейса шо инпут шо форвард дропаем
- потом шото открываем
- *разрешать айсиэмпи лучше ограничено и потом почитать, микрочел по простому накручивал пакет-сайз: 0-128, коннекшн-рейт: 0-128К (не запингуют нас, говорит)*
- ну и по-дефолту, все закрываем снаружи на инпут
- он еще закрывает снаружи на форвард, по идее так как инициируют соединения изнутри, то все окей, они будут естейблишед и все окей, но нужно порт форвардинг разрешать, а то это уже форвард после ната (***или же в дропе можно указать кроме дст-нат***)
- ну и понятно можно зафасттречить форвард деф. флаги (работает только для тсп и юдп) и ставим выше всего по идее

#### Блокировки


---
## Notes
- адрес лист загружиает я так понял и флешку и оперу
- 

---
